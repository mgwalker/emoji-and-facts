<html>
  <head>
    <style type="text/css">
      .container {
        display: flex;
        flex-wrap: wrap;
        position: fixed;
        top: 3rem;
        left: 0;
        height: calc(100vh - 3rem);
        width: 100vw;
        overflow: auto;
        justify-content: center;
        align-items: center;
      }

      .column {
        width: calc((100vw / 10) - 2px);
        height: calc((100vw / 10) - 2px);
        text-align: center;
        border: 1px solid black;
      }

      .column img {
        max-height: calc((100vw / 10) - 10px);
        max-width: calc((100vw / 10) - 10px);
        padding: 5px;
      }

      .column:hover {
        background-color: #fff1d2;
      }

      .column .tooltip {
        display: none;
        width: 120px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 5px 0;
        border-radius: 6px;

        /* Position the tooltip text - see examples below! */
        position: absolute;
        z-index: 1;
      }

      /* Show the tooltip text when you mouse over the tooltip container */
      .column:hover .tooltip {
        display: block;
      }

      #search-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100vw;
        height: 3rem;
        background: #1188ff;

        input {
          border-radius: 1rem;
          height: 2.5rem;
          margin: 0.25rem 0.5rem;
          padding: 0.5rem;
          width: 30vw;
          float: right;
        }
      }
    </style>
  </head>
  <body>
    <div id="search-container">
      <input id="search" type="text" placeholder="search" />
    </div>
    <div class="container"></div>

    <script type="text/javascript">
      const container = document.querySelector('.container');

      let render = () => {};
      let nextScrollLoad =
        0.9 * (container.scrollHeight - container.offsetHeight);

      const renderEmoji = (emojis) => {
        container.innerHTML = '';
        let startingAt = 0;
        return () => {
          for (
            let i = startingAt;
            i < startingAt + 100 && i < emojis.length;
            i += 1
          ) {
            const emoji = emojis[i];

            const column = document.createElement('div');
            column.setAttribute('class', 'column');

            const img = document.createElement('img');
            img.setAttribute('src', emoji.file);
            column.appendChild(img);

            const tooltip = document.createElement('span');
            tooltip.setAttribute('class', 'tooltip');
            tooltip.innerHTML = emoji.aliases.join('<br/>');
            column.appendChild(tooltip);

            container.appendChild(column);
          }

          startingAt += 100;
        };
      };

      const beginRender = (emojis) => {
        render = renderEmoji(emojis);
        render();
        nextScrollLoad =
          0.9 * (container.scrollHeight - container.offsetHeight);
      };

      container.addEventListener('scroll', () => {
        if (container.scrollTop > nextScrollLoad) {
          render();
          nextScrollLoad =
            container.scrollHeight - container.offsetHeight - 200;
        }
      });

      const main = async () => {
        const { map, emojis } = await fetch('meta.json')
          .then((r) => r.json())
          .then((emojis) => {
            const emojiByCode = new Map();

            for (const emoji of Object.values(emojis)) {
              emoji.aliases.forEach((alias) => emojiByCode.set(alias, emoji));
            }
            return { map: emojiByCode, emojis: Object.values(emojis) };
          });

        beginRender(emojis);

        const input = document.getElementById('search');
        const search = () => {
          const term = input.value.toLowerCase().replace(/[^a-z0-9]/i, '');
          const termRegex = new RegExp(term, 'i');

          if (term === '') {
            beginRender(emojis);
            return;
          }

          const results = new Set();

          for (const [key, emoji] of map) {
            const k = key.toLowerCase().replace(/[^a-z0-9]/i, '');
            if (k.startsWith(term) || term.startsWith(k) || termRegex.test(k)) {
              results.add(emoji);
            }
          }

          beginRender(Array.from(results));
        };

        input.addEventListener('input', search);
      };

      document.addEventListener('DOMContentLoaded', main);
    </script>
  </body>
</html>
